# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Prompt Caching

## üöÄ –ß—Ç–æ —Ç–∞–∫–æ–µ Prompt Caching?

**Prompt Caching** ‚Äî —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è OpenAI, –∫–æ—Ç–æ—Ä–∞—è –∫–µ—à–∏—Ä—É–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —á–∞—Å—Ç–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ API. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –∑–∞–¥–µ—Ä–∂–∫—É –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

## ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏

Prompt caching –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π:
- `gpt-4o` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- `gpt-4o-mini` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏)
- `gpt-4o-2024-08-06`
- `o1-preview`
- `o1-mini`
- Fine-tuned –≤–µ—Ä—Å–∏–∏ —ç—Ç–∏—Ö –º–æ–¥–µ–ª–µ–π

## üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- OpenAI –∫–µ—à–∏—Ä—É–µ—Ç –Ω–∞–∏–±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å –ø—Ä–æ–º–ø—Ç–∞ (–Ω–∞—á–∏–Ω–∞—è —Å 1024 —Ç–æ–∫–µ–Ω–æ–≤)
- –ö–µ—à –∂–∏–≤–µ—Ç **5-10 –º–∏–Ω—É—Ç** –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º 1 —á–∞—Å)
- –°–∫–∏–¥–∫–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ **50%** –Ω–∞ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ input —Ç–æ–∫–µ–Ω—ã

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å **–±–æ–ª–µ–µ 1024 —Ç–æ–∫–µ–Ω–æ–≤**
- –ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —á–∞—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **–≤ –Ω–∞—á–∞–ª–µ** –ø—Ä–æ–º–ø—Ç–∞
- –ó–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ **–≤ —Ç–µ—á–µ–Ω–∏–µ 5-10 –º–∏–Ω—É—Ç** –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## üõ†Ô∏è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ prompt_cache_key

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `prompt_cache_key` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
# –í prompt_builder.py –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –∫–µ—à–∞
cache_key = compute_cache_key(rules_text, allowed_statuses)
# –ù–∞–ø—Ä–∏–º–µ—Ä: "rules_a3f2e9c8d1b4f567"

# –ö–ª—é—á –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ OpenAI API
response = client.chat.completions.create(
    model="gpt-4o",
    messages=messages,
    extra_body={"prompt_cache_key": cache_key}
)
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `cache_key`
- OpenAI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç –∫–ª—é—á –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤—ã–π –∫–ª—é—á ‚Üí –Ω–æ–≤—ã–π –∫–µ—à
- –ü–æ–≤—ã—à–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å cache hit —Å 80% –¥–æ 92%+

### 2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

–ü—Ä–æ–º–ø—Ç—ã –≤ `prompt_builder.py` —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
messages = [
    # –°–¢–ê–¢–ò–ß–ï–°–ö–ê–Ø –ß–ê–°–¢–¨ (–∫–µ—à–∏—Ä—É–µ—Ç—Å—è) ~2000+ —Ç–æ–∫–µ–Ω–æ–≤
    {"role": "system", "content": system_prompt},         # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ JSON —Å—Ö–µ–º–∞
    {"role": "user", "content": rules_prompt},            # –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ + allowed_statuses
    {"role": "assistant", "content": "–ü–æ–Ω—è–ª –ø—Ä–∞–≤–∏–ª–∞..."},# –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    
    # –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ê–Ø –ß–ê–°–¢–¨ (–Ω–µ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è) ~100-500 —Ç–æ–∫–µ–Ω–æ–≤
    {"role": "user", "content": row_data}                 # –î–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
]
```

**–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å (–ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏) –æ–¥–∏–Ω–∞–∫–æ–≤–∞ –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å (–¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏) –≤ –∫–æ–Ω—Ü–µ –∏ –º–µ–Ω—è–µ—Ç—Å—è
- OpenAI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–µ—à–∏—Ä—É–µ—Ç –≤–µ—Å—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–µ—Ñ–∏–∫—Å

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–µ—à–∞

–í `llm_client.py` –¥–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

```python
# –í –ª–æ–≥–∞—Ö –≤—ã —É–≤–∏–¥–∏—Ç–µ:
# [INFO] Prompt cache hit: 2048/2500 tokens (81.9%) | Total: 3000 tokens
```

–≠—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –°–∫–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω–æ–≤ –≤–∑—è—Ç–æ –∏–∑ –∫–µ—à–∞ (2048)
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ prompt —Ç–æ–∫–µ–Ω–æ–≤ (2500)
- –ü—Ä–æ—Ü–µ–Ω—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (81.9%)

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

```yaml
llm:
  max_retries: 3
  providers:
    1:
      name: gpt4o-primary
      model: gpt-4o                    # –ú–æ–¥–µ–ª—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
      api_key_env: OPENAI_API_KEY
      temperature: 0.0
      max_output_tokens: 10000
      request_timeout: 60
    2:
      name: gpt4o-mini-fallback
      model: gpt-4o-mini               # –î–µ—à–µ–≤–ª–µ, —Ç–æ–∂–µ —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
      api_key_env: OPENAI_API_KEY
      temperature: 0.0
      max_output_tokens: 10000

batch_size: 10                         # –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–∞–º–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–µ—à–∞
```

**–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `batch_size: 10` –∏–ª–∏ –±–æ–ª—å—à–µ ‚Äî —ç—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∫–µ—à—É –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏.

## üí∞ –≠–∫–æ–Ω–æ–º–∏—è

### –†–∞—Å—á–µ—Ç –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

**–ë–µ–∑ prompt caching:**
```
–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ 1 –∑–∞–ø—Ä–æ—Å:
- System prompt: ~500 —Ç–æ–∫–µ–Ω–æ–≤
- Rules + allowed statuses: ~2000 —Ç–æ–∫–µ–Ω–æ–≤
- Row data: ~200 —Ç–æ–∫–µ–Ω–æ–≤
–ò—Ç–æ–≥–æ: ~2700 —Ç–æ–∫–µ–Ω–æ–≤ √ó —Ü–µ–Ω–∞ input

100 –∑–∞–ø—Ä–æ—Å–æ–≤ = 270,000 input —Ç–æ–∫–µ–Ω–æ–≤
```

**–° prompt caching:**
```
–ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å (cache write):
- 2700 —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ –ø–æ–ª–Ω–æ–π —Ü–µ–Ω–µ

–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ 99 –∑–∞–ø—Ä–æ—Å–æ–≤ (cache hit):
- 2500 —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ —Å–Ω–∏–∂–µ–Ω–Ω–æ–π —Ü–µ–Ω–µ (50% —Å–∫–∏–¥–∫–∞)
- 200 —Ç–æ–∫–µ–Ω–æ–≤ row data –ø–æ –ø–æ–ª–Ω–æ–π —Ü–µ–Ω–µ

–≠–∫–æ–Ω–æ–º–∏—è: ~50% –Ω–∞ input —Ç–æ–∫–µ–Ω–∞—Ö –¥–ª—è 99% –∑–∞–ø—Ä–æ—Å–æ–≤
```

### –ü—Ä–∏–º–µ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (GPT-4o)

| –°—Ü–µ–Ω–∞—Ä–∏–π | Input —Ç–æ–∫–µ–Ω—ã | –°—Ç–æ–∏–º–æ—Å—Ç—å (100 –∑–∞–ø—Ä–æ—Å–æ–≤) |
|----------|--------------|--------------------------|
| **–ë–µ–∑ –∫–µ—à–∞** | 270,000 | $0.675 |
| **–° –∫–µ—à–µ–º** | 2,700 + 267,300√ó0.5 = 136,350 | $0.341 |
| **–≠–∫–æ–Ω–æ–º–∏—è** | - | **49.5%** üí∞ |

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∫–µ—à–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å —Ñ–ª–∞–≥–æ–º `--verbose`:

```bash
status-validator --config config.yaml --verbose --limit 20
```

–í –ª–æ–≥–∞—Ö –∏—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:
```
[INFO] Prompt cache hit: 2048/2500 tokens (81.9%) | Total: 3000 tokens
```

### –ü—Ä–∏–∑–Ω–∞–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

‚úÖ **–•–æ—Ä–æ—à–æ:**
- –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å: `No cached tokens`
- –í—Ç–æ—Ä–æ–π –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ: `Prompt cache hit: 2000+/2500 tokens (80%+)`

‚ùå **–ü–ª–æ—Ö–æ:**
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã: `No cached tokens` ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–¥–µ–ª—å (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å gpt-4o/gpt-4o-mini)
- –ù–∏–∑–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –∫–µ—à–∞ (<50%) ‚Üí –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–º–ø—Ç –º–µ–Ω—å—à–µ 1024 —Ç–æ–∫–µ–Ω–æ–≤

## üéì –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç prompt_cache_key

`prompt_cache_key` - —ç—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è OpenAI API:

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª
cache_key = compute_cache_key(rules_text, allowed_statuses)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "rules_a3f2e9c8d1b4f567"

# –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∫–ª—é—á
# ‚Üí OpenAI –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –æ–Ω–∏ —Å–≤—è–∑–∞–Ω—ã
# ‚Üí –õ—É—á—à–∏–π cache hit rate
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü–æ–≤—ã—à–∞–µ—Ç cache hit rate —Å ~80% –¥–æ ~92%
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª
- ‚úÖ –£–Ω–∏–∫–∞–ª–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ö–æ–≥–¥–∞ –∫–ª—é—á –º–µ–Ω—è–µ—Ç—Å—è:**
- –ò–∑–º–µ–Ω–∏–ª–∏—Å—å `rules_text` –≤ config.yaml
- –ò–∑–º–µ–Ω–∏–ª—Å—è —Å–ø–∏—Å–æ–∫ `allowed_statuses`
- –ù–æ–≤—ã–π –∫–ª—é—á ‚Üí –Ω–æ–≤—ã–π –∫–µ—à (—ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!)

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ cache_key

–í –ª–æ–≥–∞—Ö —Å `--verbose` –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
[DEBUG] Using prompt_cache_key: rules_a3f2e9c8d1b4f567
[INFO] Prompt cache hit: 2487/2698 tokens (92.2%) | Total: 3421 tokens
```

–ï—Å–ª–∏ –∫–ª—é—á –º–µ–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `rules_text` —Å—Ç–∞–±–∏–ª–µ–Ω.

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ö–µ—à –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ª–æ–≥–∞—Ö –≤—Å–µ–≥–¥–∞ `No cached tokens`

**–†–µ—à–µ–Ω–∏—è:**
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–¥–µ–ª—å:**
   ```yaml
   model: gpt-4o  # –ù–ï gpt-4-turbo –∏–ª–∏ gpt-3.5-turbo
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞:**
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å > 1024 —Ç–æ–∫–µ–Ω–æ–≤
   - –í–∞—à–∏ –ø—Ä–∞–≤–∏–ª–∞ (~2000 —Ç–æ–∫–µ–Ω–æ–≤) –ø–æ–¥—Ö–æ–¥—è—Ç ‚úÖ

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏:**
   - –ö–µ—à –∂–∏–≤–µ—Ç 5-10 –º–∏–Ω—É—Ç
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `batch_size: 10` –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –ù–∏–∑–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –∫–µ—à–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** Cache hit rate < 50%

**–†–µ—à–µ–Ω–∏—è:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `rules_text` –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `allowed_statuses` –æ–¥–∏–Ω–∞–∫–æ–≤—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∞—Ç—á–µ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –±–µ–∑ –±–æ–ª—å—à–∏—Ö –ø–∞—É–∑

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ gpt-4o-mini** –¥–ª—è —Ä—É—Ç–∏–Ω–Ω—ã—Ö –∑–∞–¥–∞—á:
   ```yaml
   model: gpt-4o-mini  # –í 10 —Ä–∞–∑ –¥–µ—à–µ–≤–ª–µ gpt-4o, —Å –∫–µ—à–µ–º –µ—â–µ –≤—ã–≥–æ–¥–Ω–µ–µ
   ```

2. **–£–≤–µ–ª–∏—á—å—Ç–µ batch_size:**
   ```yaml
   batch_size: 20  # –ë–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–¥—Ä—è–¥ = –±–æ–ª—å—à–µ cache hits
   ```

3. **–ó–∞–ø—É—Å–∫–∞–π—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é –±–∞—Ç—á–∞–º–∏:**
   ```bash
   # –ü–ª–æ—Ö–æ: –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ —Å –ø–∞—É–∑–∞–º–∏
   status-validator --limit 10
   # –ü–∞—É–∑–∞ 10 –º–∏–Ω—É—Ç - –∫–µ—à –ø—Ä–æ—Ç—É—Ö
   status-validator --limit 10
   
   # –•–æ—Ä–æ—à–æ: –æ–¥–∏–Ω –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
   status-validator  # –í—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å—Ä–∞–∑—É
   ```

### –î–ª—è production

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –∫–µ—à–∞** –≤ –≤–∞—à–∏—Ö –¥–∞—à–±–æ—Ä–¥–∞—Ö
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ scheduled runs** (cron/systemd) –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ batch_size** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫:
   - < 50 —Å—Ç—Ä–æ–∫: `batch_size: 10`
   - 50-200 —Å—Ç—Ä–æ–∫: `batch_size: 20`
   - > 200 —Å—Ç—Ä–æ–∫: `batch_size: 50`

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [OpenAI Prompt Caching Documentation](https://platform.openai.com/docs/guides/prompt-caching)
- [Pricing Calculator](https://openai.com/pricing)

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –í–∫–ª—é—á–∏—Ç–µ `--verbose` –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—É—é –º–æ–¥–µ–ª—å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `openai>=1.12.0` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

